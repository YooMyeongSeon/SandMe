<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
	
<mapper namespace="com.green.sandme.member.cart.dao.CartDao">

	<!-- 장바구니에 저장 -->
	<insert id="insertCart" parameterType="com.green.sandme.member.cart.vo.CartVo">
		INSERT INTO cart_tbl VALUES(cart_seq.nextval, #{memberNum}, #{cartOrder}, #{cartAddress}, #{shopNum}, #{menuNum}, #{cartCustom}, #{cartDrink}, #{cartQuantity})
	</insert>

	<!-- 장바구니 리스트 조회 --> 
	<select id="selectCartList" resultType="com.green.sandme.member.cart.vo.CartListVo" parameterType="int">
		SELECT c.memberNum, c.cartNum, c.custom, c.cartAddress, c.cartCount, m.menuName, m.menuPrice
		FROM cart_tbl c INNER JOIN menu_tbl m
		ON c.cartMenu = m.menuNum
		WHERE c.memberNum = (
		        SELECT me.memberNum
		        FROM member_tbl me INNER JOIN cart_tbl c
		        ON me.memberNum = c.memberNum
		        WHERE me.memberNum = #{memberNum}
		        GROUP BY me.memberNum)
	</select>  
	
	<!-- 카트 체크 -->
	<select id="cartCheck" parameterType="com.green.sandme.order.vo.CartCheckVo" resultType="int">
		SELECT count(*) FROM cart_tbl WHERE memberNum = #{memberNum} and cartOrder = #{order}
	</select>




 
	
	<!-- 장바구니 목록 삭제 -->    
<!--     <delete id="deleteCart" parameterType="int">
    	DELETE FROM cart_tbl
    	WHERE cartNum =  #{cartNum}
    </delete>
    
	주문서에서 조회
 	<select id="selectCartOrder" parameterType="com.green.sandme.member.cart.vo.CartOrderVO" resultType="com.green.sandme.member.cart.vo.CartOrderVO">
 		SELECT c.memberNum, c.cartNum, c.custom, c.cartAddress, c.cartCount, m.menuName, m.menuPrice
				FROM cart_tbl c INNER JOIN menu_tbl m
				ON c.cartMenu = m.menuNum 
				INNER JOIN member_tbl me
				ON c.memberNum = me.memberNum								
				WHERE c.cartNum IN 
			<foreach collection="list" item="cartNum" open="(" separator="," close=")">
				#{cartNum}
			</foreach>		
 	</select>	
	
	장바구니 총 금액 계산	
	<select id="cartTotalPrice" parameterType="com.green.sandme.member.cart.vo.CartOrderVO" resultType="com.green.sandme.member.cart.vo.CartOrderVO">
		SELECT NVL(SUM(menuPrice * cartCount), 0) totalPrice
		FROM cart_tbl c, menu_tbl m
		WHERE c.cartMenu = m.menuNum  
		AND c.cartNum IN 
		<foreach collection="list" item="cartNum" open="(" separator="," close=")">
				#{cartNum}
		</foreach>
	</select> -->
    
</mapper>