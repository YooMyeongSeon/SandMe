<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
	<meta charset="UTF-8">
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script> <!-- 제이쿼리 -->
	<link rel="stylesheet" href="./css/style_base.css"> <!-- 베이스 스타일 시트 -->
	<title>샌드미 : 회원가입</title>
</head>
<body>
	<th:block th:replace="fragments/header :: headerFragment"></th:block> <!-- 헤더 -->
	<section>
		<form action="/joinProcess" method="POST" id="jp">
			<label for="memberName">이름</label>
			<input type="text" name="memberName" id="userName"><br>
			<label for="memberEmail">아이디</label>
			<input type="email" maxlength="20" placeholder="이메일 형식으로 입력하세요" name="memberEmail"  id="memberEmail"><br>
			<span class="id_input_re_1" style="color: green; display:none;">사용 가능한 아이디 입니다.</span>
			<span class="id_input_re_2" style="color: red; display:none;">이미 존재하는 아이디 입니다.</span>
			<label for="memberPwd">비밀번호</label>
			<input type="password" maxlength="15" autocomplete="off" name="memberPwd" id="userPwd"><br>
			<label for="memberTel">전화번호</label>
			<input type="text" name="memberTel" id="userTel"><br>
<!-- 			<input type="radio" name="auth" value="ROLE_ADMIN,ROLE_USER"> admin
			<input type="radio" name="auth" value="ROLE_USER" checked="checked">user<br> -->
			<input type="button" value="회원가입" onclick="check()">		
		</form>
		<th:block th:replace="fragments/footer :: footerFragment"></th:block> <!-- 푸터 -->
	</section>
	<script>
		function check(){	
	        if($('#userName').val() == ""){
	            alert('이름을 입력하세요!');
	            $('#userName').focus();
	            
	        }else if($('#memberEmail').val() == ""){
	            alert('아이디를 입력하세요!');
	            $('#memberEmail').focus();
	
	        }
	        else if($('#userPwd').val() == ""){
	            alert('비밀번호를 입력하세요!');
	            $('#userPwd').focus();
	
	        }else if($('#userTel').val() == ""){
	            alert('전화번호를 입력하세요!');
	            $('#userTel').focus();
	        }else {
	            alert('회원가입이 완료되었습니다.');
				$('#jp').submit();
	        } 
	        	       
		}	
		
/* 	var csrfHeaderName = "${_csrf.headerName}";
	var csrfTokenVlue = "${_csrf.token}"; */
	
	//아이디 중복 검사        //input에 입력한 순간 감지하기
	$("#memberEmail").on("propertychange change keyup paste input", 
			function(){
				var memberEmail = $("#memberEmail").val();
				var data = {memberEmail : memberEmail}
				
				$.ajax({
					type:"post",
					url:"idChk",
/* 					beforeSend : function(xhr){
						xhr.setRequestHeader(csrfHeaderName, csrfTokenValue); 
					},*/
					data:data,
					success : function(result){
						if(result != "fail"){
							$(".id_input_re_1").css("display", "inline-block");
							$(".id_input_re_2").css("display","none");
						}else{
							$(".id_input_re_1").css("display", "none");
							$(".id_input_re_2").css("display","inline-block");
						}
					}
				});
	});

	</script>	
</body>
</html>